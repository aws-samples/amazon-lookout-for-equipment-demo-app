{
    "Comment": "Copy a file from an S3 location and launch the dataset import",
    "StartAt": "Copy file from S3 source",
    "States": {
      "Copy file from S3 source": {
        "Type": "Task",
        "Resource": "arn:aws:states:::lambda:invoke",
        "Parameters": {
          "FunctionName": "${function-csv-from-s3}:$LATEST",
          "Payload.$": "$"
        },
        "Retry": [
          {
            "ErrorEquals": [
              "Lambda.ServiceException",
              "Lambda.AWSLambdaException",
              "Lambda.SdkClientException",
              "Lambda.TooManyRequestsException"
            ],
            "IntervalSeconds": 1,
            "MaxAttempts": 3,
            "BackoffRate": 2
          }
        ],
        "Next": "Data preparation workflow",
        "ResultPath": null
      },
      "Data preparation workflow": {
        "Type": "Task",
        "Resource": "arn:aws:states:::states:startExecution.sync:2",
        "Parameters": {
          "StateMachineArn.$": "$.datasetPreparationSfnArn",
          "Input": {
            "detail": {
              "bucket": {
                "name.$": "$.targetBucket"
              },
              "object": {
                "key.$": "$.targetPrefix"
              }
            },
            "AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$": "$$.Execution.Id"
          }
        },
        "End": true
      }
    }
  }